<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title>Document</title>

    <style>
        #video-container {
            position: relative;
            width: 300px; /* Breite des Video-Containers */
            height: 150px; /* H√∂he des Video-Containers */
        }

        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px; /* Breite des Videos */
            height: 150px; /* H√∂he des Videos */
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px; /* Breite des Overlays */
            height: 150px; /* H√∂he des Overlays */
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video" autoplay muted></video>
        <canvas id="overlay"></canvas>
    </div>

    <a-scene>
        <a-plane position="-1 0 3" rotation="0 45 0" color="#4CC3D9"></a-box>
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
        <a-sky color="#ECECEC"></a-sky>
      </a-scene>

      
    <script src="face-api.min.js"></script>
    <script>
       const video = document.getElementById('video');
        const overlay = document.getElementById('overlay');
        const overlayContext = overlay.getContext('2d');
       

        Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri('/models'),
        faceapi.nets.faceLandmark68Net.loadFromUri('/models'),
        faceapi.nets.faceRecognitionNet.loadFromUri('/models'),
        faceapi.nets.faceExpressionNet.loadFromUri('/models')
        ]).then(startVideo)

        function startVideo() {
        navigator.getUserMedia(
            { video: {} },
            stream => video.srcObject = stream,
            err => console.error(err)
        )
        }

        video.addEventListener('play', () => {
        const canvas = faceapi.createCanvasFromMedia(video)
        document.body.append(canvas)
        const displaySize = { width: canvas.width, height: canvas.height }
        faceapi.matchDimensions(canvas, displaySize)
        setInterval(async () => {
            const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()
            const resizedDetections = faceapi.resizeResults(detections, displaySize)
            canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)
            faceapi.draw.drawDetections(canvas, resizedDetections)
            faceapi.draw.drawFaceLandmarks(canvas, resizedDetections)
            faceapi.draw.drawFaceExpressions(canvas, resizedDetections)
        }, 1000)
        })

        function getEmojiForExpression(expressions) {
        const expressionThreshold = 0.1; // Sie k√∂nnen diesen Schwellenwert anpassen
            if (expressions.happy > expressionThreshold) return 'üòÄ';
            if (expressions.sad > expressionThreshold) return 'üò¢';
            if (expressions.angry > expressionThreshold) return 'üò†';
            if (expressions.surprised > expressionThreshold) return 'üòÆ';
            if (expressions.disgusted > expressionThreshold) return 'ü§¢';
            if (expressions.fearful > expressionThreshold) return 'üò®';
            if (expressions.neutral > expressionThreshold) return 'üòê';
            return 'üòê'; // Kein ausdrucksstarkes Emoji
}

const smileyContainer = document.createElement('div');
smileyContainer.style.position = 'fixed';
smileyContainer.style.bottom = '10px';
smileyContainer.style.right = '10px';
document.body.appendChild(smileyContainer);

function displayEmoji(emoji) {
    const emojiElement = document.createElement('span');
    emojiElement.innerText = emoji;
    emojiElement.style.fontSize = '24px';
    emojiElement.style.marginRight = '10px';
    smileyContainer.appendChild(emojiElement);
}

// Funktion, um alle 5 Sekunden die Emojis zu aktualisieren
function updateEmojis() {
    setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();
        if (detections.length > 0) {
            const currentExpressions = detections[0].expressions;
            const currentEmoji = getEmojiForExpression(currentExpressions);
            smileyContainer.innerHTML = ''; // Leere den Container, bevor du das neue Emoji hinzuf√ºgst
            displayEmoji(currentEmoji);
        }
    }, 5000); // Alle 5 Sekunden
}

// Starte den Video-Stream und die Emojis
startVideo();
updateEmojis();

    </script> 
       
</body>
</html>